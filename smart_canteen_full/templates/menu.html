{% extends 'base.html' %}
{% block content %}

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Menu</h2>
  <div>
    <a href="{% url 'cart_view' %}" class="btn btn-outline-primary">
      Cart <span class="badge bg-secondary">{{ cart_count }}</span> (₹{{ cart_total }})
    </a>
  </div>
</div>

<!-- FILTERS -->
<form method="get" class="row g-3 mb-4">

  <!-- Search -->
  <div class="col-md-4">
    <input 
      type="text" 
      name="q" 
      value="{{ request.GET.q }}" 
      class="form-control" 
      placeholder="Search items..."
    >
  </div>

  <!-- Category Filter -->
  <div class="col-md-3">
    <select name="category" class="form-select">
      <option value="">All categories</option>

      {% for cat in categories %}
      <option value="{{ cat }}"
        {% if cat == selected_category %} selected {% endif %}>
        {{ cat }}
      </option>
      {% endfor %}
    </select>
  </div>

  <!-- Available Only Checkbox -->
  <div class="col-md-3 d-flex align-items-center">
    <div class="form-check">
      <input 
        class="form-check-input"
        type="checkbox"
        name="available_only"
        id="available_only"
        value="on"
        {% if request.GET.available_only == "on" %} checked {% endif %}
      >
      <label class="form-check-label" for="available_only">Available only</label>
    </div>
  </div>

  <!-- Button -->
  <div class="col-md-2">
    <button class="btn btn-primary w-100" type="submit">Filter</button>
  </div>

</form>

<!-- MENU ITEMS -->
<div class="row">
  {% for item in items %}
  <div class="col-md-4 mb-3">
    
    <div class="card h-100">

      <!-- Image -->
      {% if item.image %}
        <img src="{{ item.image.url }}" class="card-img-top" style="height:200px; object-fit:cover;">
      {% else %}
        <img src="https://via.placeholder.com/300x200.png?text=No+Image" class="card-img-top">
      {% endif %}

      <div class="card-body d-flex flex-column">

        <!-- Title -->
        <h5 class="card-title mt-2">{{ item.name }}</h5>

        <!-- Rating Stars -->
        <div class="mb-1">
          {% for i in "12345" %}
            {% if forloop.counter <= item.rating %}
              <span class="text-warning">★</span>
            {% else %}
              <span class="text-muted">☆</span>
            {% endif %}
          {% endfor %}
        </div>

        <!-- Category -->
        <p class="card-text text-muted small">{{ item.category }}</p>

        <!-- Description -->
        <p class="card-text flex-grow-1">{{ item.description|default:"Tasty item" }}</p>

        <!-- Price + Buttons -->
        <div class="d-flex justify-content-between align-items-center mt-2">
          
          <span class="fw-bold">₹{{ item.price }}</span>

          <div>

            {% if item.available %}
              <a href="{% url 'add_to_cart' item.id %}" class="btn btn-sm btn-success">Add</a>
            {% else %}
              <span class="badge bg-secondary">Not Available</span>
            {% endif %}

            {% if user.is_staff %}
              <a href="{% url 'toggle_item' item.id %}" class="btn btn-sm btn-outline-danger">Toggle</a>
            {% endif %}

          </div>
        </div>

      </div>
    </div>

  </div>
  {% empty %}
  <p>No items found.</p>
  {% endfor %}
</div>

{% endblock %}
